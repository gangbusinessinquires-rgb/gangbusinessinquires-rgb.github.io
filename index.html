<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DevPortfolio</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <div class="container">
        <h1 style="font-size: 3rem;">Mastering <span style="color:var(--accent)">Logic</span></h1>
        <div id="bot-grid" style="display:grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 25px;"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBxZOiNLQixhfEK5_U-yf1wDi7f1oyM9NQ",
            authDomain: "portfolio-a8de0.firebaseapp.com",
            projectId: "portfolio-a8de0",
            appId: "1:352813143804:web:9ab1d0f59f38d0b519e979"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        let teamData = {};

        // 1. First, Cache Team Data for Instant Lookup
        onSnapshot(collection(db, "team"), s => {
            s.forEach(d => teamData[d.id] = d.data());
            loadBots(); // Only load bots once we have team data
        });

        function loadBots() {
            onSnapshot(collection(db, "bots"), s => {
                const grid = document.getElementById('bot-grid');
                grid.innerHTML = "";
                s.forEach(doc => {
                    const bot = doc.data();
                    
                    // Generate Avatar Stack
                    let avatarHtml = "";
                    if(bot.assignees) {
                        bot.assignees.forEach(id => {
                            if(teamData[id]) {
                                avatarHtml += `<img src="${teamData[id].avatar}" title="${teamData[id].name}">`;
                            }
                        });
                    }

                    grid.innerHTML += `
                        <div class="bot-card">
                            <img src="${bot.avatar}" class="bot-img">
                            <h3>${bot.name}</h3>
                            <p style="font-size:0.9rem; color:#888;">${bot.desc}</p>
                            <div class="contributor-stack">
                                ${avatarHtml}
                                <span style="font-size:0.7rem; color:#555; margin-left:10px;">CONTRIBUTORS</span>
                            </div>
                            <a href="${bot.invite}" class="primary-btn" style="display:block; text-align:center; margin-top:15px; text-decoration:none;">Add Bot</a>
                        </div>
                    `;
                });
            });
        }
    </script>
</body>
</html>

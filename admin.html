<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Architecture Console</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <div class="container">
        <div id="login-gate" style="max-width:400px; margin: 100px auto;" class="bot-card">
            <h2>System Login</h2>
            <input type="email" id="email" class="admin-input" placeholder="Email">
            <input type="password" id="password" class="admin-input" placeholder="Password">
            <button id="login-btn" class="primary-btn">Login</button>
        </div>

        <div id="dashboard" style="display:none;">
            <div class="grid" style="display:grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                <div class="bot-card">
                    <h3>ðŸ¤– Bot Editor</h3>
                    <input type="hidden" id="bot-id">
                    <input type="text" id="bName" class="admin-input" placeholder="Bot Name">
                    <textarea id="bDesc" class="admin-input" placeholder="Description"></textarea>
                    
                    <label style="font-size:0.8rem; color:var(--accent);">ASSIGN CONTRIBUTORS</label>
                    <div id="assignee-selector" class="assignee-list"></div>
                    
                    <div style="display:flex; gap:10px; margin-top:15px;">
                        <input type="number" id="bUsers" class="admin-input" placeholder="Users">
                        <input type="number" id="bServers" class="admin-input" placeholder="Servers">
                    </div>
                    <input type="text" id="bAvatar" class="admin-input" placeholder="Image URL">
                    <input type="text" id="bInvite" class="admin-input" placeholder="Invite Link">
                    <button onclick="saveBot()" class="primary-btn">Publish Project</button>
                </div>

                <div class="bot-card">
                    <h3>ðŸ‘¥ Team Editor</h3>
                    <input type="text" id="tName" class="admin-input" placeholder="Full Name">
                    <input type="text" id="tRole" class="admin-input" placeholder="Role">
                    <input type="text" id="tAvatar" class="admin-input" placeholder="Avatar URL">
                    <button onclick="saveMember()" class="primary-btn">Save Member</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBxZOiNLQixhfEK5_U-yf1wDi7f1oyM9NQ",
            authDomain: "portfolio-a8de0.firebaseapp.com",
            projectId: "portfolio-a8de0",
            appId: "1:352813143804:web:9ab1d0f59f38d0b519e979"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        document.getElementById('login-btn').onclick = () => {
            signInWithEmailAndPassword(auth, document.getElementById('email').value, document.getElementById('password').value);
        };

        onAuthStateChanged(auth, u => {
            if(u) {
                document.getElementById('login-gate').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
            }
        });

        // Load Team into Checkboxes
        onSnapshot(collection(db, "team"), s => {
            const container = document.getElementById('assignee-selector');
            container.innerHTML = "";
            s.forEach(d => {
                container.innerHTML += `<div><input type="checkbox" name="devs" value="${d.id}"> ${d.data().name}</div>`;
            });
        });

        window.saveBot = async () => {
            const id = document.getElementById('bot-id').value;
            const selectedDevs = Array.from(document.querySelectorAll('input[name="devs"]:checked')).map(c => c.value);
            const data = {
                name: document.getElementById('bName').value,
                desc: document.getElementById('bDesc').value,
                assignees: selectedDevs,
                users: document.getElementById('bUsers').value,
                servers: document.getElementById('bServers').value,
                avatar: document.getElementById('bAvatar').value,
                invite: document.getElementById('bInvite').value
            };
            id ? await updateDoc(doc(db, "bots", id), data) : await addDoc(collection(db, "bots"), data);
            location.reload();
        };

        window.saveMember = async () => {
            await addDoc(collection(db, "team"), {
                name: document.getElementById('tName').value,
                role: document.getElementById('tRole').value,
                avatar: document.getElementById('tAvatar').value
            });
            location.reload();
        };
    </script>
</body>
</html>

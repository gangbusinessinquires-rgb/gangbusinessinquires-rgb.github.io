<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dev Portfolio | Logic & Web</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
</head>
<body>
    <nav>
        <div class="logo">DEV<span>PORTFOLIO</span></div>
        <a href="admin.html" class="login-btn">Admin Portal</a>
    </nav>

    <div class="hero">
        <div class="badge">‚ú® Professional Development</div>
        <h1>Mastering <span>Logic</span></h1>
        <div class="tech-stack">
            <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/javascript/javascript-original.svg" alt="JS" class="hero-icon">
            <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/python/python-original.svg" alt="Python" class="hero-icon">
            <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/html5/html5-original.svg" alt="HTML" class="hero-icon">
        </div>
        
        <div id="commission-status" class="status-badge-container"></div>

        <div class="stats-container">
            <div class="stat-box"><div class="stat-val" id="total-users">0</div><div class="stat-label">Users</div></div>
            <div class="stat-box"><div class="stat-val" id="total-servers">0</div><div class="stat-label">Servers</div></div>
        </div>
    </div>

    <div class="container">
        <h2 class="section-title">Projects</h2>
        <div id="bot-display" class="grid"></div>
        
        <h2 class="section-title" style="margin-top: 80px;">The Team</h2>
        <div id="team-display" class="grid-team"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBxZOiNLQixhfEK5_U-yf1wDi7f1oyM9NQ",
            authDomain: "portfolio-a8de0.firebaseapp.com",
            projectId: "portfolio-a8de0",
            storageBucket: "portfolio-a8de0.firebasestorage.app",
            messagingSenderId: "352813143804",
            appId: "1:352813143804:web:9ab1d0f59f38d0b519e979"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let teamAvatars = {};

        onSnapshot(collection(db, "team"), (s) => {
            const display = document.getElementById('team-display');
            display.innerHTML = "";
            teamAvatars = {}; 

            s.forEach(d => {
                const t = d.data();
                teamAvatars[t.name] = t.avatar; 

                display.innerHTML += `
                    <div class="team-card">
                        <img src="${t.avatar || 'https://via.placeholder.com/60'}" class="team-avatar">
                        <div class="team-info">
                            <h4>${t.name}</h4>
                            <span class="role-badge">${t.role}</span>
                            <button onclick="alert('Portfolio coming soon!')" class="member-port-btn">View Portfolio</button>
                        </div>
                    </div>`;
            });
            loadBots();
        });

        function loadBots() {
            onSnapshot(collection(db, "bots"), (s) => {
                const display = document.getElementById('bot-display');
                let u = 0, ser = 0;
                display.innerHTML = "";
                
                const bots = [];
                s.forEach(d => bots.push({id: d.id, ...d.data()}));
                bots.sort((a, b) => (b.pinned === true) - (a.pinned === true));

                bots.forEach((b) => {
                    u += parseInt(b.users || 0); ser += parseInt(b.servers || 0);
                    
                    let contributorHtml = "";
                    if (b.contributors && Array.isArray(b.contributors)) {
                        b.contributors.forEach(name => {
                            if (teamAvatars[name]) {
                                contributorHtml += `<img src="${teamAvatars[name]}" class="mini-contributor-pfp" title="${name}">`;
                            }
                        });
                    }

                    const statusColor = b.status === "Online" ? "#43b581" : "#faa61a";
                    const langImg = b.language === "JavaScript" ? 
                        "https://cdn.jsdelivr.net/gh/devicons/devicon/icons/javascript/javascript-original.svg" : 
                        "https://cdn.jsdelivr.net/gh/devicons/devicon/icons/python/python-original.svg";

                    display.innerHTML += `
                        <div class="bot-card ${b.pinned ? 'pinned' : ''}">
                            ${b.pinned ? '<div class="pin-icon">üìå Pinned</div>' : ''}
                            <div class="status-indicator" style="background:${statusColor}"></div>
                            <div class="lang-tag"><img src="${langImg}" width="14"> ${b.language || 'JS'}</div>
                            <div class="bot-header">
                                <img src="${b.avatar || 'https://via.placeholder.com/50'}" class="bot-pfp">
                                <div class="bot-identity">
                                    <div class="bot-tag">@${b.username}</div>
                                    <h3>${b.name}</h3>
                                </div>
                            </div>
                            <p class="bot-description">${b.desc}</p>
                            
                            <div class="contributor-row">
                                <div class="pfp-stack">${contributorHtml}</div>
                            </div>

                            <div class="bot-stats-row"><span>üìä ${b.servers} Servers</span><span>üë• ${b.users} Users</span></div>
                            <a href="${b.invite}" target="_blank" class="play-btn">Join Server</a>
                        </div>`;
                });

                display.innerHTML += `
                    <div class="bot-card coming-soon-card">
                        <div class="lang-tag">HTML</div>
                        <div class="coming-soon-content">
                            <div class="icon">üõ†Ô∏è</div>
                            <h3>Coming Soon</h3>
                            <p>An interactive project is in development.</p>
                        </div>
                        <button class="play-btn" style="opacity: 0.5; cursor: not-allowed;">Join Server</button>
                    </div>`;

                document.getElementById('total-users').innerText = u.toLocaleString();
                document.getElementById('total-servers').innerText = ser.toLocaleString();
            });

            onSnapshot(doc(db, "settings", "commissions"), (docSnap) => {
                const statusDiv = document.getElementById('commission-status');
                if (docSnap.exists()) {
                    const isOpen = docSnap.data().open;
                    statusDiv.innerHTML = `<div class="comm-pill ${isOpen ? 'open' : 'closed'}">
                        Commissions: ${isOpen ? 'üü¢ Open' : 'üî¥ Closed'}
                    </div>`;
                }
            });
        }
    </script>
</body>
</html>
